<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TyrexCAD Professional v3.0 - Advanced CAD System</title>
    <!-- Font Awesome for Professional Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <script>window.addEventListener('error',e=>{if(e.message&&(e.message.includes('export')||e.message.includes('import')||e.message.includes('ctx.save')))e.preventDefault()});</script>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">T</div>
    </div>
    
    <!-- Application Header -->
    <header class="app-header">
        <div class="app-branding">
            <div class="app-logo">T</div>
            <div>
                <div class="app-title">TyrexCAD Professional</div>
                <div class="app-version">Version 3.0</div>
            </div>
        </div>
        <div style="display: flex; gap: 20px; align-items: center;">
            <button class="btn" onclick="newFile()"><i class="fas fa-file"></i> New</button>
            <button class="btn" onclick="openFile()"><i class="fas fa-folder-open"></i> Open</button>
            <button class="btn" onclick="saveFile()"><i class="fas fa-save"></i> Save</button>
            <button class="btn" onclick="exportFile()"><i class="fas fa-file-export"></i> Export</button>
        </div>
    </header>
    
    <!-- Ribbon Interface -->
    <div class="ribbon-container">
        <div class="ribbon-tabs">
            <div class="ribbon-tab active" onclick="showRibbon('draw')">Draw</div>
            <div class="ribbon-tab" onclick="showRibbon('modify')">Modify</div>
            <div class="ribbon-tab" onclick="showRibbon('annotate')">Annotate</div>
            <div class="ribbon-tab" onclick="showRibbon('view')">View</div>
            <div class="ribbon-tab" onclick="showRibbon('tools')">Tools</div>
            <div class="ribbon-tab" onclick="showRibbon('3d')">3D</div>
        </div>
        
        <!-- Draw Ribbon -->
        <div class="ribbon-content active" id="ribbon-draw">
            <div class="ribbon-group">
                <div class="ribbon-group-title">Lines</div>
                <div class="ribbon-group-content">
                    <div class="ribbon-tool" onclick="setTool('line')" title="Draw Line">
                        <div class="ribbon-tool-icon"><i class="fas fa-slash"></i></div>
                        <div class="ribbon-tool-label">Line</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('polyline')" title="Draw Polyline">
                        <div class="ribbon-tool-icon"><i class="fas fa-route"></i></div>
                        <div class="ribbon-tool-label">Polyline</div>
                    </div>
                </div>
            </div>
            
            <div class="ribbon-group">
                <div class="ribbon-group-title">Shapes</div>
                <div class="ribbon-group-content">
                    <div class="ribbon-tool" onclick="setTool('rectangle')" title="Draw Rectangle">
                        <div class="ribbon-tool-icon"><i class="far fa-square"></i></div>
                        <div class="ribbon-tool-label">Rectangle</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('circle')" title="Draw Circle">
                        <div class="ribbon-tool-icon"><i class="far fa-circle"></i></div>
                        <div class="ribbon-tool-label">Circle</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('arc')" title="Draw Arc">
                        <div class="ribbon-tool-icon"><i class="fas fa-bezier-curve"></i></div>
                        <div class="ribbon-tool-label">Arc</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('ellipse')" title="Draw Ellipse">
                        <div class="ribbon-tool-icon"><i class="fas fa-egg"></i></div>
                        <div class="ribbon-tool-label">Ellipse</div>
                    </div>
                    
                    <!-- Advanced Drawing Tools -->
                    <button id="polygon" class="tool-btn" onclick="setTool('polygon')" title="Polygon (POL)">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L3 7V17L12 22L21 17V7L12 2Z" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Drawing Settings -->
            <div class="ribbon-group">
                <div class="ribbon-group-title">Drawing Settings</div>
                <div class="ribbon-group-content">
                    <div class="ribbon-tool" onclick="window.cad && window.cad.ui && window.cad.ui.showLinetypePanel && window.cad.ui.showLinetypePanel()" title="Line Type">
                        <div class="ribbon-tool-icon">
                            <svg width="30" height="20" style="vertical-align: middle;">
                                <line x1="5" y1="10" x2="25" y2="10" stroke="currentColor" stroke-width="2" id="ribbonLinetypeDisplay"/>
                            </svg>
                        </div>
                        <div class="ribbon-tool-label">Line Type</div>
                    </div>
                    <div class="ribbon-tool" onclick="window.cad && window.cad.ui && window.cad.ui.showLineWeightPanel && window.cad.ui.showLineWeightPanel()" title="Line Weight">
                        <div class="ribbon-tool-icon"><i class="fas fa-weight"></i></div>
                        <div class="ribbon-tool-label">Weight</div>
                    </div>
                    <div class="ribbon-tool" onclick="toggleColorDropdown()" title="Color">
                        <div class="ribbon-tool-icon">
                            <div style="width: 24px; height: 24px; border-radius: 4px; background: var(--accent-primary); border: 2px solid var(--border-color);"></div>
                        </div>
                        <div class="ribbon-tool-label">Color</div>
                    </div>
                </div>
            </div>
            
            <!-- Ø¥Ø¶Ø§ÙØ© ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ù€ Ribbon - Draw -->
            <div class="ribbon-group">
                <div class="ribbon-group-title">Layers</div>
                <div class="ribbon-group-content">
                    <div class="ribbon-tool" onclick="window.cad && window.cad.ui && window.cad.ui.showLayerManager && window.cad.ui.showLayerManager()" title="Layer Manager">
                        <div class="ribbon-tool-icon"><i class="fas fa-layer-group"></i></div>
                        <div class="ribbon-tool-label">Manager</div>
                    </div>
                    <div class="ribbon-tool" onclick="window.cad && window.cad.matchLayer && window.cad.matchLayer()" title="Match Layer">
                        <div class="ribbon-tool-icon"><i class="fas fa-eyedropper"></i></div>
                        <div class="ribbon-tool-label">Match</div>
                    </div>
                    <div class="ribbon-tool" onclick="window.cad && window.cad.ui && window.cad.ui.showLayerStatesDialog && window.cad.ui.showLayerStatesDialog()" title="Layer States">
                        <div class="ribbon-tool-icon"><i class="fas fa-save"></i></div>
                        <div class="ribbon-tool-label">States</div>
                    </div>
                </div>
            </div>
            
            <!-- Ø¥Ø¶Ø§ÙØ© ÙÙŠ Ø§Ù„Ù€ Ribbon - Draw -->
            <div class="ribbon-group">
                <div class="ribbon-group-title">Line Properties</div>
                <div class="ribbon-group-content">
                    <div class="ribbon-tool" onclick="window.cad && window.cad.ui && window.cad.ui.showLinetypePanel && window.cad.ui.showLinetypePanel()" title="Linetype Manager">
                        <div class="ribbon-tool-icon"><i class="fas fa-grip-lines"></i></div>
                        <div class="ribbon-tool-label">Linetypes</div>
                    </div>
                    <div class="ribbon-tool" onclick="window.cad && window.cad.ui && window.cad.ui.showLineWeightPanel && window.cad.ui.showLineWeightPanel()" title="Line Weight">
                        <div class="ribbon-tool-icon"><i class="fas fa-weight"></i></div>
                        <div class="ribbon-tool-label">Weights</div>
                    </div>
                    <div class="ribbon-tool" onclick="window.cad && window.cad.matchProperties && window.cad.matchProperties()" title="Match Properties">
                        <div class="ribbon-tool-icon"><i class="fas fa-paint-brush"></i></div>
                        <div class="ribbon-tool-label">Match</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modify Ribbon - ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ø¨Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
        <div class="ribbon-content" id="ribbon-modify">
            <div class="ribbon-group">
                <div class="ribbon-group-title">Transform</div>
                <div class="ribbon-group-content">
                    <div class="ribbon-tool" onclick="setTool('move')" title="Move Objects">
                        <div class="ribbon-tool-icon"><i class="fas fa-arrows-alt"></i></div>
                        <div class="ribbon-tool-label">Move</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('copy')" title="Copy Objects">
                        <div class="ribbon-tool-icon"><i class="fas fa-copy"></i></div>
                        <div class="ribbon-tool-label">Copy</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('rotate')" title="Rotate Objects">
                        <div class="ribbon-tool-icon"><i class="fas fa-sync-alt"></i></div>
                        <div class="ribbon-tool-label">Rotate</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('scale')" title="Scale Objects">
                        <div class="ribbon-tool-icon"><i class="fas fa-expand-arrows-alt"></i></div>
                        <div class="ribbon-tool-label">Scale</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('mirror')" title="Mirror Objects">
                        <div class="ribbon-tool-icon"><i class="fas fa-object-ungroup"></i></div>
                        <div class="ribbon-tool-label">Mirror</div>
                    </div>
                </div>
            </div>
            
            <div class="ribbon-group">
                <div class="ribbon-group-title">Edit</div>
                <div class="ribbon-group-content">
                    <div class="ribbon-tool" onclick="setTool('trim')" title="Trim Objects">
                        <div class="ribbon-tool-icon"><i class="fas fa-cut"></i></div>
                        <div class="ribbon-tool-label">Trim</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('extend')" title="Extend Objects">
                        <div class="ribbon-tool-icon"><i class="fas fa-expand"></i></div>
                        <div class="ribbon-tool-label">Extend</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('offset')" title="Offset Objects">
                        <div class="ribbon-tool-icon"><i class="fas fa-clone"></i></div>
                        <div class="ribbon-tool-label">Offset</div>
                    </div>
                    <!-- ðŸ†• Ø£Ø¯Ø§Ø© Stretch Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
                    <div class="ribbon-tool" onclick="setTool('stretch')" title="Stretch Objects (STR)">
                        <div class="ribbon-tool-icon"><i class="fas fa-arrows-alt-h"></i></div>
                        <div class="ribbon-tool-label">Stretch</div>
                    </div>
                    
                    <div class="tool-separator"></div>
                    
                    <!-- Advanced Modify Tools -->
                    <button id="fillet" class="tool-btn" onclick="setTool('fillet')" title="Fillet (F)">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4 4V16C4 18 6 20 8 20H20" stroke="currentColor" stroke-width="2"/>
                            <path d="M4 16Q4 20 8 20" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                    </button>
                    
                    <button id="chamfer" class="tool-btn" onclick="setTool('chamfer')" title="Chamfer (CHA)">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4 4V16L8 20H20" stroke="currentColor" stroke-width="2"/>
                            <path d="M4 16L8 20" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </button>
                    
                    <div class="tool-separator"></div>
                    
                    <!-- Array Tools Dropdown -->
                    <div class="dropdown">
                        <button class="tool-btn" onclick="toggleArrayMenu()" title="Array (AR)">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="3" y="3" width="6" height="6" stroke="currentColor" stroke-width="2"/>
                                <rect x="9" y="3" width="6" height="6" stroke="currentColor" stroke-width="2"/>
                                <rect x="15" y="3" width="6" height="6" stroke="currentColor" stroke-width="2"/>
                                <rect x="3" y="9" width="6" height="6" stroke="currentColor" stroke-width="2"/>
                                <rect x="9" y="9" width="6" height="6" stroke="currentColor" stroke-width="2"/>
                                <rect x="15" y="9" width="6" height="6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </button>
                        <div id="arrayMenu" class="dropdown-content">
                            <button onclick="setTool('rectangular-array')">Rectangular Array</button>
                            <button onclick="setTool('polar-array')">Polar Array</button>
                            <button onclick="setTool('path-array')">Path Array</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ðŸ†• Ù…Ø¬Ù…ÙˆØ¹Ø© Break Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
            <div class="ribbon-group">
                <div class="ribbon-group-title">Break</div>
                <div class="ribbon-group-content">
                    <!-- ðŸ†• Ø£Ø¯Ø§Ø© Break -->
                    <div class="ribbon-tool" onclick="setTool('break')" title="Break Objects Between Two Points (BR)">
                        <div class="ribbon-tool-icon"><i class="fas fa-cut"></i></div>
                        <div class="ribbon-tool-label">Break</div>
                    </div>
                    <!-- ðŸ†• Ø£Ø¯Ø§Ø© Break at Point -->
                    <div class="ribbon-tool" onclick="setTool('break-at-point')" title="Break Objects at Point (BRP)">
                        <div class="ribbon-tool-icon"><i class="fas fa-crosshairs"></i></div>
                        <div class="ribbon-tool-label">Break@Pt</div>
                    </div>
                </div>
            </div>
            
            <!-- Boolean Operations Section -->
            <div class="tool-section">
                <div class="section-label">BOOLEAN</div>
                
                <button class="tool-btn" onclick="activateTool('union')" title="Union (UNI)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="10" cy="12" r="6" stroke="currentColor" stroke-width="2" fill="none"/>
                        <circle cx="14" cy="12" r="6" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M10 6.5C11.5 8 12.5 10 12.5 12C12.5 14 11.5 16 10 17.5C8.5 16 7.5 14 7.5 12C7.5 10 8.5 8 10 6.5Z" fill="currentColor" opacity="0.3"/>
                    </svg>
                </button>
                
                <button class="tool-btn" onclick="activateTool('difference')" title="Difference (DIF)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="10" cy="12" r="6" stroke="currentColor" stroke-width="2" fill="none"/>
                        <circle cx="14" cy="12" r="6" stroke="currentColor" stroke-width="2" stroke-dasharray="3 3"/>
                        <path d="M10 6.5C8.5 8 7.5 10 7.5 12C7.5 14 8.5 16 10 17.5" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </button>
                
                <button class="tool-btn" onclick="activateTool('intersection')" title="Intersection (INT)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="10" cy="12" r="6" stroke="currentColor" stroke-width="2" fill="none" opacity="0.5"/>
                        <circle cx="14" cy="12" r="6" stroke="currentColor" stroke-width="2" fill="none" opacity="0.5"/>
                        <path d="M10 6.5C11.5 8 12.5 10 12.5 12C12.5 14 11.5 16 10 17.5C11.5 16 12.5 14 12.5 12C12.5 10 11.5 8 10 6.5Z" fill="currentColor"/>
                    </svg>
                </button>
            </div>
            
            <!-- Analysis Tools Section -->
            <div class="tool-section">
                <div class="section-label">ANALYSIS</div>
                
                <button class="tool-btn" onclick="activateTool('distance-analysis')" title="Distance (DIST)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 12H20M4 12L7 9M4 12L7 15M20 12L17 9M20 12L17 15" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </button>
                
                <button class="tool-btn" onclick="activateTool('area-analysis')" title="Area">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="4" y="4" width="16" height="16" stroke="currentColor" stroke-width="2" fill="currentColor" opacity="0.2"/>
                        <text x="12" y="12" text-anchor="middle" dominant-baseline="middle" fill="currentColor" font-size="10">A</text>
                    </svg>
                </button>
                
                <button class="tool-btn" onclick="activateTool('properties-analysis')" title="Properties (PROP)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" stroke="currentColor" stroke-width="2"/>
                        <circle cx="12" cy="12" r="3" fill="currentColor"/>
                    </svg>
                </button>
            </div>
            
            <!-- Curve Operations Section -->
            <div class="tool-section">
                <div class="section-label">CURVES</div>
                
                <button class="tool-btn" onclick="activateTool('convert-to-polyline')" title="Convert to Polyline">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="8" stroke="currentColor" stroke-width="1" stroke-dasharray="2 2" opacity="0.5"/>
                        <polyline points="12,4 18,8 20,12 18,16 12,20 6,16 4,12 6,8 12,4" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                </button>
                
                <button class="tool-btn" onclick="activateTool('simplify-polyline')" title="Simplify">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <polyline points="4,4 8,12 16,8 20,20" stroke="currentColor" stroke-width="1" stroke-dasharray="2 2"/>
                        <polyline points="4,4 20,20" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </button>
                
                <button class="tool-btn" onclick="activateTool('smooth-polyline')" title="Smooth">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4,12 Q8,4 12,12 T20,12" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Annotate Ribbon -->
        <div class="ribbon-content" id="ribbon-annotate">
            <div class="ribbon-group">
                <div class="ribbon-group-title">Text & Dimensions</div>
                <div class="ribbon-group-content">
                    <div class="ribbon-tool" onclick="setTool('text')" title="Add Text">
                        <div class="ribbon-tool-icon"><i class="fas fa-text-height"></i></div>
                        <div class="ribbon-tool-label">Text</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('dimension')" title="Linear Dimension">
                        <div class="ribbon-tool-icon"><i class="fas fa-ruler-horizontal"></i></div>
                        <div class="ribbon-tool-label">Linear</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('dimension-angular')" title="Angular Dimension">
                        <div class="ribbon-tool-icon"><i class="fas fa-drafting-compass"></i></div>
                        <div class="ribbon-tool-label">Angular</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('dimension-radius')" title="Radius Dimension">
                        <div class="ribbon-tool-icon"><i class="fas fa-circle-notch"></i></div>
                        <div class="ribbon-tool-label">Radius</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('dimension-diameter')" title="Diameter Dimension">
                        <div class="ribbon-tool-icon"><i class="fas fa-circle"></i></div>
                        <div class="ribbon-tool-label">Diameter</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- View Ribbon -->
        <div class="ribbon-content" id="ribbon-view">
            <div class="ribbon-group">
                <div class="ribbon-group-title">Navigation</div>
                <div class="ribbon-group-content">
                    <div class="ribbon-tool" onclick="setTool('pan')" title="Pan View">
                        <div class="ribbon-tool-icon"><i class="fas fa-hand-paper"></i></div>
                        <div class="ribbon-tool-label">Pan</div>
                    </div>
                    <div class="ribbon-tool" onclick="zoomExtents()" title="Zoom Extents">
                        <div class="ribbon-tool-icon"><i class="fas fa-compress-arrows-alt"></i></div>
                        <div class="ribbon-tool-label">Zoom All</div>
                    </div>
                    <div class="ribbon-tool" onclick="zoomWindow()" title="Zoom Window">
                        <div class="ribbon-tool-icon"><i class="fas fa-search-plus"></i></div>
                        <div class="ribbon-tool-label">Zoom Window</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tools Ribbon -->
        <div class="ribbon-content" id="ribbon-tools">
            <div class="ribbon-group">
                <div class="ribbon-group-title">Selection</div>
                <div class="ribbon-group-content">
                    <div class="ribbon-tool active" onclick="setTool('select')" title="Select Objects">
                        <div class="ribbon-tool-icon"><i class="fas fa-mouse-pointer"></i></div>
                        <div class="ribbon-tool-label">Select</div>
                    </div>
                    <div class="ribbon-tool" onclick="selectAll()" title="Select All">
                        <div class="ribbon-tool-icon"><i class="fas fa-object-group"></i></div>
                        <div class="ribbon-tool-label">All</div>
                    </div>
                    <div class="ribbon-tool" onclick="deselectAll()" title="Deselect All">
                        <div class="ribbon-tool-icon"><i class="fas fa-ban"></i></div>
                        <div class="ribbon-tool-label">None</div>
                    </div>
                </div>
            </div>
            
            <div class="ribbon-group">
                <div class="ribbon-group-title">Edit</div>
                <div class="ribbon-group-content">
                    <div class="ribbon-tool" onclick="undo()" title="Undo">
                        <div class="ribbon-tool-icon"><i class="fas fa-undo"></i></div>
                        <div class="ribbon-tool-label">Undo</div>
                    </div>
                    <div class="ribbon-tool" onclick="redo()" title="Redo">
                        <div class="ribbon-tool-icon"><i class="fas fa-redo"></i></div>
                        <div class="ribbon-tool-label">Redo</div>
                    </div>
                    <div class="ribbon-tool" onclick="deleteSelected()" title="Delete">
                        <div class="ribbon-tool-icon"><i class="fas fa-trash"></i></div>
                        <div class="ribbon-tool-label">Delete</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 3D Ribbon -->
        <div class="ribbon-content" id="ribbon-3d">
            <div class="ribbon-group">
                <div class="ribbon-group-title">3D Objects</div>
                <div class="ribbon-group-content">
                    <div class="ribbon-tool" onclick="setTool('box')" title="Draw Box">
                        <div class="ribbon-tool-icon"><i class="fas fa-cube"></i></div>
                        <div class="ribbon-tool-label">Box</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('sphere')" title="Draw Sphere">
                        <div class="ribbon-tool-icon"><i class="fas fa-globe"></i></div>
                        <div class="ribbon-tool-label">Sphere</div>
                    </div>
                    <div class="ribbon-tool" onclick="setTool('cylinder')" title="Draw Cylinder">
                        <div class="ribbon-tool-icon"><i class="fas fa-database"></i></div>
                        <div class="ribbon-tool-label">Cylinder</div>
                    </div>
                </div>
            </div>
            
            <div class="ribbon-group">
                <div class="ribbon-group-title">3D View</div>
                <div class="ribbon-group-content">
                    <div class="ribbon-tool" onclick="set3DView('top')" title="Top View">
                        <div class="ribbon-tool-icon"><i class="fas fa-chevron-up"></i></div>
                        <div class="ribbon-tool-label">Top</div>
                    </div>
                    <div class="ribbon-tool" onclick="set3DView('front')" title="Front View">
                        <div class="ribbon-tool-icon"><i class="fas fa-chevron-right"></i></div>
                        <div class="ribbon-tool-label">Front</div>
                    </div>
                    <div class="ribbon-tool" onclick="set3DView('iso')" title="Isometric View">
                        <div class="ribbon-tool-icon"><i class="fas fa-cubes"></i></div>
                        <div class="ribbon-tool-label">Iso</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    
    <!-- Match Properties Tool -->
    <div id="matchPropertiesInfo" class="match-info" style="display: none;">
        Select source object for properties...
    </div>
    
    <!-- Main Container -->
    <div class="main-container">
        <!-- Canvas Container -->
        <div class="canvas-container" id="canvasContainer">
            <canvas id="mainCanvas"></canvas>
            <canvas id="canvas3D"></canvas>
            
            <!-- View Controls -->
            <div class="view-controls">
                <button class="view-btn active" onclick="setViewMode('2D')">2D</button>
                <button class="view-btn" onclick="setViewMode('3D')">3D</button>
            </div>
            
            <!-- 3D View Controls -->
            <div class="controls-3d" id="controls3D">
                <h4>3D View Controls</h4>
                <p>
                    â€¢ Left Mouse: Rotate<br>
                    â€¢ Middle Mouse: Pan<br>
                    â€¢ Scroll: Zoom<br>
                    â€¢ Right Mouse: Context Menu
                </p>
            </div>
            
            <!-- Professional Crosshair -->
            <div class="crosshair" id="crosshair">
                <div class="crosshair-line crosshair-h"></div>
                <div class="crosshair-line crosshair-v"></div>
                <div class="crosshair-center"></div>
            </div>
            
            <!-- Dynamic Input -->
            <div class="dynamic-input" id="dynamicInput">
                <span class="dynamic-input-label" id="dynamicLabel">Length:</span>
                <input type="text" class="dynamic-input-field" id="dynamicField" />
            </div>
            
            <!-- Input Dialog -->
            <div class="input-dialog" id="inputDialog">
                <div class="input-dialog-title" id="inputDialogTitle">Shape Properties</div>
                <div class="input-dialog-content" id="inputDialogContent">
                    <!-- Content will be added dynamically -->
                </div>
                <div class="input-dialog-buttons">
                    <button class="btn" onclick="cancelInputDialog()">Cancel</button>
                    <button class="btn btn-primary" onclick="confirmInputDialog()">OK</button>
                </div>
            </div>
            
            <!-- Command & Coordinates Bar -->
            <div class="input-bar">
                <div class="input-section" style="min-width: 200px;">
                    <span class="input-label">Command:</span>
                    <input type="text" class="command-input" id="commandInput" 
                           placeholder="Enter command or press F1 for help" 
                           autocomplete="off" />
                </div>
                <div class="input-section">
                    <span class="coord-display" id="coordinates">X: 0.00, Y: 0.00, Z: 0.00</span>
                </div>
            </div>
            
            <!-- Toolbar -->
            <div class="toolbar">
                <!-- Snap Button with Menu -->
                <div class="toolbar-button" id="snapButton" onclick="toggleSnapMenu()" title="Object Snap">
                    <i class="fas fa-magnet"></i>
                    <div class="snap-menu" id="snapMenu">
                        <div class="snap-menu-title">Object Snap</div>
                        <div class="snap-option" id="snapEndpoint" onclick="toggleSnapSetting('endpoint')">
                            <span class="snap-option-icon"><i class="fas fa-dot-circle"></i></span>
                            <span>Endpoint</span>
                        </div>
                        <div class="snap-option" id="snapMidpoint" onclick="toggleSnapSetting('midpoint')">
                            <span class="snap-option-icon"><i class="fas fa-minus"></i></span>
                            <span>Midpoint</span>
                        </div>
                        <div class="snap-option" id="snapCenter" onclick="toggleSnapSetting('center')">
                            <span class="snap-option-icon"><i class="far fa-circle"></i></span>
                            <span>Center</span>
                        </div>
                        <div class="snap-option" id="snapIntersection" onclick="toggleSnapSetting('intersection')">
                            <span class="snap-option-icon"><i class="fas fa-times"></i></span>
                            <span>Intersection</span>
                        </div>
                        <div class="snap-option" id="snapPerpendicular" onclick="toggleSnapSetting('perpendicular')">
                            <span class="snap-option-icon"><i class="fas fa-ruler-vertical"></i></span>
                            <span>Perpendicular</span>
                        </div>
                        <div class="snap-option" id="snapTangent" onclick="toggleSnapSetting('tangent')">
                            <span class="snap-option-icon"><i class="fas fa-arrows-alt-v"></i></span>
                            <span>Tangent</span>
                        </div>
                        <div class="snap-option" id="snapNearest" onclick="toggleSnapSetting('nearest')">
                            <span class="snap-option-icon"><i class="fas fa-magnet"></i></span>
                            <span>Nearest</span>
                        </div>
                        <div class="snap-option" id="snapGrid" onclick="toggleSnapSetting('grid')">
                            <span class="snap-option-icon"><i class="fas fa-th"></i></span>
                            <span>Grid Snap</span>
                        </div>
                    </div>
                </div>
                
                <!-- Ortho Button -->
                <div class="toolbar-button" id="orthoButton" onclick="toggleOrtho()" title="Orthogonal Mode">
                    <i class="fas fa-ruler-combined"></i>
                </div>
                
                <!-- Polar Button -->
                <div class="toolbar-button" id="polarButton" onclick="togglePolar()" title="Polar Tracking">
                    <i class="fas fa-compass"></i>
                </div>
                
                <!-- Grid Button -->
                <div class="toolbar-button" id="gridButton" onclick="toggleGrid()" title="Toggle Grid">
                    <i class="fas fa-th"></i>
                </div>
            </div>
            
            <!-- Snap Indicator -->
            <div class="snap-indicator" id="snapIndicator">
                <div class="snap-label" id="snapLabel">Grid</div>
            </div>
            
            <!-- Selection Box -->
            <div class="selection-box" id="selectionBox"></div>
            
            <!-- Zoom Window Overlay -->
            <div class="zoom-window-overlay" id="zoomWindowOverlay">
                <div class="zoom-window-box" id="zoomWindowBox"></div>
            </div>
            
            <!-- Context Menu -->
            <div class="context-menu" id="contextMenu">
                <div class="context-menu-item" onclick="repeatLastCommand()">
                    <i class="fas fa-redo"></i> Repeat Last
                </div>
                <div class="context-menu-separator"></div>
                <div class="context-menu-item" onclick="copySelected()">
                    <i class="fas fa-copy"></i> Copy
                </div>
                <div class="context-menu-item" onclick="pasteClipboard()">
                    <i class="fas fa-paste"></i> Paste
                </div>
                <div class="context-menu-separator"></div>
                <div class="context-menu-item" onclick="deleteSelected()">
                    <i class="fas fa-trash"></i> Delete
                </div>
                <div class="context-menu-separator"></div>
                <div class="context-menu-item" onclick="selectSimilar()">
                    <i class="fas fa-object-group"></i> Select Similar
                </div>
                <div class="context-menu-item" onclick="showProperties()">
                    <i class="fas fa-info-circle"></i> Properties
                </div>
            </div>
        </div>
        
        <!-- Properties Panel -->
        <div class="properties-panel" id="propertiesPanel">
            <div class="panel-header" onclick="togglePropertiesPanel()">
                <div class="panel-title">Properties</div>
                <i class="fas fa-chevron-left"></i>
            </div>
            <div class="panel-content">
                <!-- Object Properties -->
                <div class="panel-section">
                    <div class="section-title">Object Properties</div>
                    <div class="property-row">
                        <span class="property-label">Type:</span>
                        <span class="property-value" id="propType">None</span>
                    </div>
                    <div id="specificProperties"></div>
                </div>
                
                <!-- ØªØ­Ø¯ÙŠØ« Ù‚Ø³Ù… Ø§Ù„Ø·Ø¨Ù‚Ø§Øª ÙÙŠ Properties Panel -->
                <div class="panel-section">
                    <div class="section-title">
                        <span>Layers</span>
                        <div class="section-title-buttons">
                            <button class="btn btn-mini" onclick="window.cad && window.cad.ui && window.cad.ui.toggleAllLayers && window.cad.ui.toggleAllLayers(true)" title="Show All">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-mini" onclick="window.cad && window.cad.ui && window.cad.ui.toggleAllLayers && window.cad.ui.toggleAllLayers(false)" title="Hide All">
                                <i class="fas fa-eye-slash"></i>
                            </button>
                            <button class="btn btn-mini" onclick="window.cad && window.cad.ui && window.cad.ui.showLayerManager && window.cad.ui.showLayerManager()" title="Layer Manager">
                                <i class="fas fa-cog"></i>
                            </button>
                        </div>
                    </div>
                    <div id="layersList" class="layers-container"></div>
                </div>
                
                <!-- Drawing Settings -->
                <div class="panel-section">
                    <div class="section-title">Drawing Settings</div>
                    
                    <!-- Line Type -->
                    <div class="property-row">
                        <span class="property-label">Line Type:</span>
                        <button onclick="window.cad && window.cad.ui && window.cad.ui.showLinetypePanel && window.cad.ui.showLinetypePanel()" 
                                style="background: transparent; border: 1px solid var(--border-color); padding: 4px 8px; cursor: pointer; border-radius: 4px; color: var(--text-primary); width: 100%; text-align: left; display: flex; justify-content: space-between; align-items: center;">
                            <span id="propLinetype">Continuous</span>
                            <i class="fas fa-chevron-down" style="font-size: 10px;"></i>
                        </button>
                    </div>
                    
                    <!-- Line Type Preview -->
                    <div id="linetypePreview" style="margin: 8px 0;"></div>
                    
                    <!-- Line Weight -->
                    <div class="property-row">
                        <span class="property-label">Line Weight:</span>
                        <button onclick="window.cad && window.cad.ui && window.cad.ui.showLineWeightPanel && window.cad.ui.showLineWeightPanel()"
                                style="background: transparent; border: 1px solid var(--border-color); padding: 4px 8px; cursor: pointer; border-radius: 4px; color: var(--text-primary); width: 100%; text-align: left; display: flex; justify-content: space-between; align-items: center;">
                            <span id="propLineweight">0.25 mm</span>
                            <i class="fas fa-chevron-down" style="font-size: 10px;"></i>
                        </button>
                    </div>
                    
                    <!-- Linetype Scale -->
                    <div class="property-row">
                        <span class="property-label">Linetype Scale:</span>
                        <div class="input-group">
                            <input type="number" id="linetypeScale" 
                                   value="1" min="0.1" max="10" step="0.1"
                                   onchange="window.cad && window.cad.linetypeManager && window.cad.linetypeManager.setGlobalLinetypeScale && window.cad.linetypeManager.setGlobalLinetypeScale(this.value)"
                                   style="width: 80px; background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary); padding: 4px; border-radius: 4px;">
                            <button class="btn btn-mini" onclick="window.cad && window.cad.ui && window.cad.ui.showLinetypePanel && window.cad.ui.showLinetypePanel()">
                                <i class="fas fa-cog"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Color -->
                    <div class="property-row">
                        <span class="property-label">Color:</span>
                        <div class="color-dropdown" id="colorDropdown">
                            <div class="color-dropdown-toggle" onclick="toggleColorDropdown()">
                                <div class="color-preview" id="currentColorPreview" style="background: #00d4aa;"></div>
                                <span id="currentColorText">#00d4aa</span>
                                <i class="fas fa-chevron-down" style="margin-left: auto;"></i>
                            </div>
                            <div class="color-dropdown-menu">
                                <div class="color-grid" id="colorGrid"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bottom Status Bar -->
    <footer class="bottom-bar">
        <div class="bottom-section">
            <div class="bottom-item">
                <span class="status-indicator" style="width: 6px; height: 6px; border-radius: 50%; background: var(--accent-primary);"></span>
                <span id="statusMode">READY</span>
            </div>
        </div>
        
        <!-- Ø¥Ø¶Ø§ÙØ© ÙÙŠ Bottom Bar -->
        <div class="bottom-section">
            <div class="bottom-item">
                <span class="bottom-label">LType:</span>
                <span class="bottom-value" id="statusLinetype">Continuous</span>
            </div>
            <div class="bottom-item">
                <span class="bottom-label">LWeight:</span>
                <span class="bottom-value" id="statusLineWeight">0.25 mm</span>
            </div>
        </div>
        
        <div class="bottom-section">
            <div class="bottom-item">
                Tool: <span class="bottom-value" id="statusTool">SELECT</span>
            </div>
            <!-- Ø¥Ø¶Ø§ÙØ© Layer Dropdown ÙÙŠ Ø§Ù„Ù€ Bottom Bar -->
            <div class="bottom-item">
                <span class="bottom-label">Layer:</span>
                <select id="currentLayerSelect" class="layer-select" onchange="window.cad && window.cad.setCurrentLayer && window.cad.setCurrentLayer(parseInt(this.value))">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </select>
            </div>
            <div class="bottom-item">
                Objects: <span class="bottom-value" id="statusObjects">0</span>
            </div>
        </div>
        
        <div class="bottom-section">
            <div class="bottom-item">
                SNAP: <span class="bottom-value" id="statusSnap">ON</span>
            </div>
            <div class="bottom-item">
                GRID: <span class="bottom-value" id="statusGrid">ON</span>
            </div>
            <div class="bottom-item">
                ORTHO: <span class="bottom-value" id="statusOrtho">OFF</span>
            </div>
            <div class="bottom-item">
                POLAR: <span class="bottom-value" id="statusPolar">OFF</span>
            </div>
            <div class="bottom-item">
                Units: 
                <select id="unitsSelect" onchange="changeUnits(this.value)" 
                        style="background: transparent; border: 1px solid var(--border-color); 
                               color: var(--text-primary); padding: 2px; font-size: 11px;">
                    <option value="mm">mm</option>
                    <option value="cm">cm</option>
                    <option value="m">m</option>
                    <option value="in">in</option>
                    <option value="ft">ft</option>
                </select>
            </div>
            <div class="bottom-item">
                <span class="bottom-value" id="fps">60 FPS</span>
            </div>
        </div>
    </footer>
    
    <!-- JavaScript Files -->
    <!-- Core Library (Clipper.js) only -->
    <script src="js/lib/clipper.js"></script>
    
    <!-- Main App Module (Vite) -->
    <script type="module" src="/js/main.js"></script>
    
    <!-- Simple UI Helper Functions -->
    <script>
        // Ribbon tabs
        function showRibbon(tab) {
            document.querySelectorAll('.ribbon-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.ribbon-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`ribbon-${tab}`).classList.add('active');
        }
        
        // Array menu
        function toggleArrayMenu() {
            const menu = document.getElementById('arrayMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }
        
        // ðŸ†• Ø¥Ø¶Ø§ÙØ© Ø¯Ø¹Ù… Ø§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        document.addEventListener('keydown', function(e) {
            // ØªØ£ÙƒØ¯ Ø£Ù† focus Ù„ÙŠØ³ Ø¹Ù„Ù‰ input field
            if (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA') return;
            
            const key = e.key.toLowerCase();
            
            // Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            switch(key) {
                case 's':
                    if (e.ctrlKey) return; // ØªØ¬Ù†Ø¨ ØªØ¯Ø§Ø®Ù„ Ù…Ø¹ Ctrl+S (Save)
                    if (e.shiftKey) {
                        // Shift+S Ù„Ù„Stretch
                        setTool('stretch');
                        e.preventDefault();
                    }
                    break;
                    
                case 'b':
                    if (e.shiftKey) {
                        // Shift+B Ù„Ù„Break at Point
                        setTool('break-at-point');
                    } else {
                        // B Ù„Ù„Break
                        setTool('break');
                    }
                    e.preventDefault();
                    break;
                    
                // Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
                case 'm':
                    if (e.ctrlKey) return;
                    setTool('move');
                    e.preventDefault();
                    break;
                    
                case 'c':
                    if (e.ctrlKey) return; // ØªØ¬Ù†Ø¨ ØªØ¯Ø§Ø®Ù„ Ù…Ø¹ Ctrl+C
                    setTool('copy');
                    e.preventDefault();
                    break;
                    
                case 'r':
                    if (e.ctrlKey) return;
                    setTool('rotate');
                    e.preventDefault();
                    break;
            }
        });
        
        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        function updateToolButtonState(activeTool) {
            // Ø¥Ø²Ø§Ù„Ø© Ø­Ø§Ù„Ø© active Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.ribbon-tool').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ù„Ø© active Ù„Ù„Ø£Ø¯Ø§Ø© Ø§Ù„Ù†Ø´Ø·Ø©
            document.querySelectorAll('.ribbon-tool').forEach(btn => {
                const onclick = btn.getAttribute('onclick');
                if (onclick && onclick.includes(`'${activeTool}'`)) {
                    btn.classList.add('active');
                }
            });
        }
        
        // Layer dropdown update function
        function updateLayerDropdown() {
            const select = document.getElementById('currentLayerSelect');
            if (!select || !window.cad) return;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ù„Ø© getCurrentLayerId
            if (typeof window.cad.getCurrentLayerId !== 'function') {
                console.warn('getCurrentLayerId not available yet');
                return;
            }
            
            select.innerHTML = '';
            
            const layers = window.cad.layerManager ? 
                Array.from(window.cad.layerManager.layers.values()) : 
                Array.from(window.cad.layers.values());
            
            layers.forEach(layer => {
                const option = document.createElement('option');
                option.value = layer.id;
                option.textContent = layer.name;
                if (layer.id === window.cad.getCurrentLayerId()) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }

        // Ø±Ø¨Ø· Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø¯ÙˆØ§Øª
        if (window.cad) {
            const originalSetTool = window.setTool;
            window.setTool = function(tool) {
                if (originalSetTool) {
                    originalSetTool(tool);
                }
                updateToolButtonState(tool);
            };
        }

        // Initialize layer dropdown when CAD is ready
        document.addEventListener('DOMContentLoaded', function() {
            let checkInterval;
            let attempts = 0;
            
            function checkCADReady() {
                attempts++;
                
                if (window.cad && typeof window.cad.getCurrentLayerId === 'function') {
                    clearInterval(checkInterval);
                    
                    // ØªØ­Ø¯ÙŠØ« dropdown Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                    updateLayerDropdown();
                    
                    // Hook into layer updates
                    if (window.cad.ui && window.cad.ui.updateLayersList) {
                        const originalUpdateLayersList = window.cad.ui.updateLayersList;
                        window.cad.ui.updateLayersList = function() {
                            originalUpdateLayersList.call(this);
                            updateLayerDropdown();
                        };
                    }
                    
                    console.log('âœ… Layer dropdown initialized');
                } else if (attempts > 50) {
                    clearInterval(checkInterval);
                    console.warn('CAD loading timeout - layer dropdown may not work properly');
                }
            }
            
            checkInterval = setInterval(checkCADReady, 100);
        });
    </script>
    
</body>
</html>